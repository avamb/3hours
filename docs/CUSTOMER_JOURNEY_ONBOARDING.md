# ๐บ๏ธ Customer Journey Map: Onboarding Flow

**ะะฐัะฐ:** 2026-01-21  
**ะะตััะธั:** 1.0  
**ะะพั:** MindSetHappyBot

---

## ๐ ะะฑะทะพั

ะญัะพั ะดะพะบัะผะตะฝั ะพะฟะธััะฒะฐะตั ะฟะพัะฐะณะพะฒัะน Customer Journey ะฝะพะฒะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั ะพั ะผะพะผะตะฝัะฐ ะทะฐะฟััะบะฐ ะฑะพัะฐ ะดะพ ะฟะพะปััะตะฝะธั ะฟะตัะฒะพะณะพ ะฒะพะฟัะพัะฐ.

**ะัะตะผั ะฟัะพัะพะถะดะตะฝะธั:** ~30-60 ัะตะบัะฝะด  
**ะจะฐะณะพะฒ:** 5 ะพัะฝะพะฒะฝัั ััะฐะฟะพะฒ

---

## ๐ฏ ะญัะฐะฟ 1: ะะตัะฒัะน ะทะฐะฟััะบ (/start)

### ะขัะธะณะณะตั
ะะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะปัะตั ะบะพะผะฐะฝะดั `/start` ะฒ Telegram ะฑะพัะต.

### ะงัะพ ะฟัะพะธััะพะดะธั:
1. **ะกะพะทะดะฐะฝะธะต/ะฟะพะปััะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั**
   - `UserService.get_or_create_user()` ะฒัะทัะฒะฐะตััั
   - ะกะพะทะดะฐะตััั ะฝะพะฒะฐั ะทะฐะฟะธัั ะฒ ะะ (ะตัะปะธ ะฝะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั)
   - ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตััั:
     - `first_name` ะธะท Telegram ะฟัะพัะธะปั
     - `language_code` ะธะท Telegram ะฝะฐัััะพะตะบ ะฟะพะปัะทะพะฒะฐัะตะปั (ะฟะพ ัะผะพะปัะฐะฝะธั "ru")

2. **ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะพะฝะฑะพัะดะธะฝะณะฐ**
   - ะัะพะฒะตััะตััั `user.onboarding_completed == False`
   - ะัะปะธ `True` โ ะฟะพะบะฐะทัะฒะฐะตััั "Welcome back"
   - ะัะปะธ `False` โ ะทะฐะฟััะบะฐะตััั onboarding flow

### ะงัะพ ะฒะธะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั:
```
[ะะทะพะฑัะฐะถะตะฝะธะต: ะฟัะธะฒะตัััะฒะตะฝะฝะฐั ะบะฐััะธะฝะบะฐ]
๐ธ Unsplash ัะพัะพ: ะฟะพะทะธัะธะฒะฝะฐั ัะตะผะฐัะธะบะฐ
   URL: https://images.unsplash.com/photo-1506905925346-21bda4d32df4
   ะะพะบะฐะปัะฝัะน ะฟััั (ะตัะปะธ ะตััั): assets/welcome.jpg
```

**ะกะพะพะฑัะตะฝะธะต (ะปะพะบะฐะปะธะทะพะฒะฐะฝะฝะพะต ะฟะพ ัะทัะบั ะฟะพะปัะทะพะฒะฐัะตะปั):**

**๐ท๐บ ะัััะบะธะน:**
```
ะัะธะฒะตั, {first_name}! ๐

ะฏ โ ัะฒะพะน ะฟะพะผะพัะฝะธะบ ะดะปั ัะฐะทะฒะธัะธั ะฟะพะทะธัะธะฒะฝะพะณะพ ะผััะปะตะฝะธั. 
ะะฐะถะดัะน ะดะตะฝั ั ะฑัะดั ัะฟัะฐัะธะฒะฐัั ัะตะฑั ะพ ัะพัะพัะตะผ, 
ััะพะฑั ะฒะผะตััะต ะทะฐะผะตัะฐัั ัะฐะดะพััะฝัะต ะผะพะผะตะฝัั ะถะธะทะฝะธ. โจ

ะะฐะฒะฐะน ะฝะฐัะฝัะผ! ะะฐะบ ัะตะฑะต ัะดะพะฑะฝะตะต ะพะฑัะฐัััั?
```

**๐ฌ๐ง English:**
```
Hello, {first_name}! ๐

I'm your assistant for developing positive thinking. 
Every day I will ask you about good things, 
so that we can notice the joyful moments of life together. โจ

Let's begin! How would you prefer to communicate?
```

**๐บ๐ฆ ะฃะบัะฐัะฝััะบะฐ:**
```
ะัะธะฒัั, {first_name}! ๐

ะฏ โ ัะฒัะน ะฟะพะผััะฝะธะบ ะดะปั ัะพะทะฒะธัะบั ะฟะพะทะธัะธะฒะฝะพะณะพ ะผะธัะปะตะฝะฝั. 
ะฉะพะดะฝั ั ะฑัะดั ะทะฐะฟะธััะฒะฐัะธ ัะตะฑะต ะฟัะพ ัะพัะพัะต, 
ัะพะฑ ัะฐะทะพะผ ะฟะพะผััะฐัะธ ัะฐะดััะฝั ะผะพะผะตะฝัะธ ะถะธััั. โจ

ะะฐะฒะฐะน ะฟะพัะฝะตะผะพ! ะฏะบ ัะพะฑั ะทัััะฝััะต ัะฟัะปะบัะฒะฐัะธัั?
```

### ะะฝัะตัะฐะบัะธะฒะฝัะต ัะปะตะผะตะฝัั:
**Inline ะบะปะฐะฒะธะฐัััะฐ:**
```
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโ
โ  ะะฐ ยซััยป ๐     โ   ะะฐ ยซะฒัยป ๐ค     โ
โโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโ
```

**ะะพะด:** `get_onboarding_keyboard(language_code)`

---

## ๐ฏ ะญัะฐะฟ 2: ะัะฑะพั ัะพัะผั ะพะฑัะฐัะตะฝะธั

### ะขัะธะณะณะตั
ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั ะพะดะฝั ะธะท ะบะฝะพะฟะพะบ:
- `"address_informal"` โ ะะฐ ยซััยป ๐
- `"address_formal"` โ ะะฐ ยซะฒัยป ๐ค

### ะงัะพ ะฟัะพะธััะพะดะธั:
1. **ะกะพััะฐะฝะตะฝะธะต ะฝะฐัััะพะนะบะธ**
   - `user.formal_address = False` (ะดะปั "ัั")
   - `user.formal_address = True` (ะดะปั "ะฒั")
   - ะกะพััะฐะฝัะตััั ะฒ ะะ ัะตัะตะท `update_user_settings()`

2. **ะะพะปััะตะฝะธะต ัะตะบััะฐ ะฟะพะดัะฒะตัะถะดะตะฝะธั**
   - ะัะฟะพะปัะทัะตััั `get_onboarding_text("address_informal_confirm", language_code)` ะธะปะธ
   - ะัะฟะพะปัะทัะตััั `get_onboarding_text("address_formal_confirm", language_code)`

3. **ะะฑะฝะพะฒะปะตะฝะธะต ัะพะพะฑัะตะฝะธั**
   - ะััะพะดะฝะพะต ัะพะพะฑัะตะฝะธะต ัะตะดะฐะบัะธััะตััั (`callback.message.edit_text()`)
   - ะะฝะพะฟะบะธ ะฒัะฑะพัะฐ ัะพัะผั ะพะฑัะฐัะตะฝะธั ะทะฐะผะตะฝััััั ะฝะฐ ะณะปะฐะฒะฝะพะต ะผะตะฝั

4. **ะะฐะฒะตััะตะฝะธะต ะพะฝะฑะพัะดะธะฝะณะฐ**
   - ะัะทัะฒะฐะตััั `user_service.complete_onboarding(telegram_id)`
   - `user.onboarding_completed = True` ัะพััะฐะฝัะตััั ะฒ ะะ

### ะงัะพ ะฒะธะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั:

**๐ท๐บ ะัััะบะธะน (ะะตัะพัะผะฐะปัะฝะพะต "ัั"):**
```
ะัะปะธัะฝะพ! ะัะดั ะพะฑัะฐัะฐัััั ะฝะฐ ยซััยป ๐

ะขะตะฟะตัั ะฝะตะผะฝะพะณะพ ะพ ัะพะผ, ะบะฐะบ ััะพ ัะฐะฑะพัะฐะตั:

โข ะะฐะถะดัะต ะฝะตัะบะพะปัะบะพ ัะฐัะพะฒ ั ัะฟัะพัั: ยซะงัะพ ัะพัะพัะตะณะพ ะฟัะพะธะทะพัะปะพ?ยป
โข ะขั ะผะพะถะตัั ะพัะฒะตัะธัั ัะตะบััะพะผ ะธะปะธ ะณะพะปะพัะพะฒัะผ ัะพะพะฑัะตะฝะธะตะผ
โข ะฏ ัะพััะฐะฝั ัะฒะพะธ ะผะพะผะตะฝัั ะธ ะฝะฐะฟะพะผะฝั ะพ ะฝะธั, ะบะพะณะดะฐ ะฟะพะฝะฐะดะพะฑะธััั ะฟะพะดะดะตัะถะบะฐ

โ๏ธ <b>ะะฐะถะฝะพ:</b> ะะพะถะฐะปัะนััะฐ, ะฝะฐัััะพะน ัะฒะพะน <b>ัะฐัะพะฒะพะน ะฟะพัั</b> ะธ <b>ัะฐััะพัั ัะพะพะฑัะตะฝะธะน</b> 
ะฒ ัะฐะทะดะตะปะต โ๏ธ ะะฐัััะพะนะบะธ, ััะพะฑั ั ะฟะธัะฐะป ัะตะฑะต ะฒ ัะดะพะฑะฝะพะต ะฒัะตะผั!

๐ ะขะฒะพะธ ะดะฐะฝะฝัะต ะฒ ะฑะตะทะพะฟะฐัะฝะพััะธ ะธ ะธัะฟะพะปัะทััััั ัะพะปัะบะพ ะดะปั ะฝะฐัะตะณะพ ะพะฑัะตะฝะธั.
ะะพะดัะพะฑะฝะตะต: /privacy
```

**๐ท๐บ ะัััะบะธะน (ะคะพัะผะฐะปัะฝะพะต "ะฒั"):**
```
ะฅะพัะพัะพ! ะัะดั ะพะฑัะฐัะฐัััั ะฝะฐ ยซะฒัยป ๐

ะขะตะฟะตัั ะฝะตะผะฝะพะณะพ ะพ ัะพะผ, ะบะฐะบ ััะพ ัะฐะฑะพัะฐะตั:

โข ะะฐะถะดัะต ะฝะตัะบะพะปัะบะพ ัะฐัะพะฒ ั ัะฟัะพัั: ยซะงัะพ ัะพัะพัะตะณะพ ะฟัะพะธะทะพัะปะพ?ยป
โข ะั ะผะพะถะตัะต ะพัะฒะตัะธัั ัะตะบััะพะผ ะธะปะธ ะณะพะปะพัะพะฒัะผ ัะพะพะฑัะตะฝะธะตะผ
โข ะฏ ัะพััะฐะฝั ะะฐัะธ ะผะพะผะตะฝัั ะธ ะฝะฐะฟะพะผะฝั ะพ ะฝะธั, ะบะพะณะดะฐ ะฟะพะฝะฐะดะพะฑะธััั ะฟะพะดะดะตัะถะบะฐ

โ๏ธ <b>ะะฐะถะฝะพ:</b> ะะพะถะฐะปัะนััะฐ, ะฝะฐัััะพะนัะต ัะฒะพะน <b>ัะฐัะพะฒะพะน ะฟะพัั</b> ะธ <b>ัะฐััะพัั ัะพะพะฑัะตะฝะธะน</b> 
ะฒ ัะฐะทะดะตะปะต โ๏ธ ะะฐัััะพะนะบะธ, ััะพะฑั ั ะฟะธัะฐะป ะะฐะผ ะฒ ัะดะพะฑะฝะพะต ะฒัะตะผั!

๐ ะะฐัะธ ะดะฐะฝะฝัะต ะฒ ะฑะตะทะพะฟะฐัะฝะพััะธ ะธ ะธัะฟะพะปัะทััััั ัะพะปัะบะพ ะดะปั ะฝะฐัะตะณะพ ะพะฑัะตะฝะธั.
ะะพะดัะพะฑะฝะตะต: /privacy
```

**๐ฌ๐ง English (Informal):**
```
Great! I'll use informal communication ๐

Here's how it works:

โข Every few hours I'll ask: "What good happened?"
โข You can reply with text or voice message
โข I'll save your moments and remind you of them when you need support

โ๏ธ <b>Important:</b> Please set up your <b>timezone</b> and <b>message frequency</b> 
in โ๏ธ Settings, so I can message you at a convenient time!

๐ Your data is safe and used only for our communication.
More info: /privacy
```

**๐ฌ๐ง English (Formal):**
```
Understood! I'll use formal communication ๐

Here's how it works:

โข Every few hours I'll ask: "What good happened?"
โข You can reply with text or voice message
โข I'll save your moments and remind you of them when you need support

โ๏ธ <b>Important:</b> Please set up your <b>timezone</b> and <b>message frequency</b> 
in โ๏ธ Settings, so I can message you at a convenient time!

๐ Your data is safe and used only for our communication.
More info: /privacy
```

### ะะฝัะตัะฐะบัะธะฒะฝัะต ัะปะตะผะตะฝัั:
**Inline ะบะปะฐะฒะธะฐัััะฐ (ะะปะฐะฒะฝะพะต ะผะตะฝั):**
```
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ ะะพะธ ะผะพะผะตะฝัั    โ  ๐ ะกัะฐัะธััะธะบะฐ     โ
โโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโค
โ  โ๏ธ ะะฐัััะพะนะบะธ      โ  ๐ฌ ะะพะณะพะฒะพัะธัั     โ
โโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโ
```

**Reply ะบะปะฐะฒะธะฐัััะฐ (ะฟะพัะฒะปัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ):**
```
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ ะะพะธ ะผะพะผะตะฝัั    โ  ๐ ะกัะฐัะธััะธะบะฐ     โ
โโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโค
โ  โ๏ธ ะะฐัััะพะนะบะธ      โ  ๐ฌ ะะพะณะพะฒะพัะธัั     โ
โโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโค
โ      ๐ก ะัะตะดะปะพะถะธัั ะธะดะตั                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะพะด:** `get_main_menu_inline(language_code)` + `get_main_menu_keyboard(language_code)`

---

## ๐ฏ ะญัะฐะฟ 3: ะัะฟัะฐะฒะบะฐ ะฟะตัะฒะพะณะพ ะฒะพะฟัะพัะฐ

### ะขัะธะณะณะตั
ะะฒัะพะผะฐัะธัะตัะบะธ ััะฐะฑะฐััะฒะฐะตั ััะฐะทั ะฟะพัะปะต ะทะฐะฒะตััะตะฝะธั ะพะฝะฑะพัะดะธะฝะณะฐ (`complete_onboarding()`).

### ะงัะพ ะฟัะพะธััะพะดะธั:
1. **ะะฝะธัะธะฐะปะธะทะฐัะธั scheduler**
   - ะัะพะฒะตััะตััั ะฝะฐะปะธัะธะต `NotificationScheduler.get_instance()`
   - ะัะปะธ ะฝะตั โ ัะพะทะดะฐะตััั ะฒัะตะผะตะฝะฝัะน ัะบะทะตะผะฟะปัั ัะตัะตะท fallback

2. **ะัะทะพะฒ ะพัะฟัะฐะฒะบะธ ะฒะพะฟัะพัะฐ**
   - `scheduler.send_first_question_after_onboarding(telegram_id)`

3. **ะะฝัััะตะฝะฝัั ะปะพะณะธะบะฐ:**
   - ะะพะปััะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั ะธะท ะะ
   - ะัะพะฒะตัะบะฐ `user.notifications_enabled` (ะฟะพ ัะผะพะปัะฐะฝะธั `True`)
   - ะะตะฝะตัะฐัะธั ะฒะพะฟัะพัะฐ ัะตัะตะท `_get_question(user)`

4. **ะะตะฝะตัะฐัะธั ะฒะพะฟัะพัะฐ:**
   - ะัะฑะพั ัะปััะฐะนะฝะพะณะพ ะฒะพะฟัะพัะฐ ะธะท ัะฟะธัะบะฐ (8 ะฒะฐัะธะฐะฝัะพะฒ)
   - ะฃัะธััะฒะฐะตััั `user.formal_address`:
     - `False` โ `DEFAULT_QUESTIONS_INFORMAL` (ัั)
     - `True` โ `DEFAULT_QUESTIONS_FORMAL` (ะฒั)
   - ะะดะฐะฟัะฐัะธั ะฟะพะด ะฟะพะป ะฟะพะปัะทะพะฒะฐัะตะปั (`adapt_question_for_gender()`)
   - ะัะบะปััะตะฝะธะต ะฟะพะฒัะพัะตะฝะธั ะฟัะตะดัะดััะตะณะพ ะฒะพะฟัะพัะฐ (ะตัะปะธ ะตััั)

5. **ะัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธั**
   - ะัะฟัะฐะฒะบะฐ ัะตัะตะท `bot.send_message()`
   - ะกะพััะฐะฝะตะฝะธะต `message_id` ะฒ `user.last_pending_prompt_message_id`
   - ะะพะณะธัะพะฒะฐะฝะธะต ะฒ `ConversationLogService`

6. **ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัะธััะธะบะธ**
   - `StatsService.increment_questions_sent(user.id)`

### ะงัะพ ะฒะธะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั:

**ะัะธะผะตัั ะฒะพะฟัะพัะพะฒ (ะะตัะพัะผะฐะปัะฝะพะต "ัั"):**
```
ะงัะพ ัะพัะพัะตะณะพ ะฟัะพะธะทะพัะปะพ ัะตะณะพะดะฝั? ๐
ะะฐััะบะฐะถะธ, ัะตะผั ัั ะฟะพัะฐะดะพะฒะฐะปัั? โจ
ะงัะพ ะฟัะธััะฝะพะณะพ ัะปััะธะปะพัั? ๐
ะะฐะบะพะน ะผะพะผะตะฝั ัะตะณะพะดะฝั ะฑัะป ะพัะพะฑะตะฝะฝัะผ? ๐ซ
ะงัะพ ัะตะฑั ัะตะณะพะดะฝั ะฒะดะพัะฝะพะฒะธะปะพ? ๐
ะะฐััะบะฐะถะธ ะพ ะผะฐะปะตะฝัะบะพะน ัะฐะดะพััะธ ะดะฝั! ๐
ะงัะพ ัะพัะพัะตะณะพ ัั ะทะฐะผะตัะธะป ัะตะณะพะดะฝั? ๐ป
ะงะตะผั ัั ัะปัะฑะฝัะปัั ัะตะณะพะดะฝั? ๐
```

**ะัะธะผะตัั ะฒะพะฟัะพัะพะฒ (ะคะพัะผะฐะปัะฝะพะต "ะฒั"):**
```
ะงัะพ ัะพัะพัะตะณะพ ะฟัะพะธะทะพัะปะพ ัะตะณะพะดะฝั? ๐
ะะฐััะบะฐะถะธัะต, ัะตะผั ะั ะฟะพัะฐะดะพะฒะฐะปะธัั? โจ
ะงัะพ ะฟัะธััะฝะพะณะพ ัะปััะธะปะพัั? ๐
ะะฐะบะพะน ะผะพะผะตะฝั ัะตะณะพะดะฝั ะฑัะป ะพัะพะฑะตะฝะฝัะผ? ๐ซ
ะงัะพ ะะฐั ัะตะณะพะดะฝั ะฒะดะพัะฝะพะฒะธะปะพ? ๐
ะะฐััะบะฐะถะธัะต ะพ ะผะฐะปะตะฝัะบะพะน ัะฐะดะพััะธ ะดะฝั! ๐
ะงัะพ ัะพัะพัะตะณะพ ะั ะทะฐะผะตัะธะปะธ ัะตะณะพะดะฝั? ๐ป
ะงะตะผั ะั ัะปัะฑะฝัะปะธัั ัะตะณะพะดะฝั? ๐
```

### ะะฝัะตัะฐะบัะธะฒะฝัะต ัะปะตะผะตะฝัั:
**Inline ะบะปะฐะฒะธะฐัััะฐ:**
```
โโโโโโโโโโโโโโโโโโโโโโโ
โ  โญ ะัะพะฟัััะธัั      โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะพะด:** `get_question_keyboard(language_code)`

---

## ๐ฏ ะญัะฐะฟ 4: ะะตัะฒัะน ะพัะฒะตั ะฟะพะปัะทะพะฒะฐัะตะปั

### ะขัะธะณะณะตั
ะะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะปัะตั ัะตะบััะพะฒะพะต ะธะปะธ ะณะพะปะพัะพะฒะพะต ัะพะพะฑัะตะฝะธะต ะฒ ะพัะฒะตั ะฝะฐ ะฒะพะฟัะพั.

### ะงัะพ ะฟัะพะธััะพะดะธั:
1. **ะะฑัะฐะฑะพัะบะฐ ัะพะพะฑัะตะฝะธั**
   - `handle_text_message()` ะธะปะธ `handle_voice_message()`
   - ะะฟัะตะดะตะปะตะฝะธะต ัะทัะบะฐ ัะพะพะฑัะตะฝะธั (ะตัะปะธ ัะตะบััะพะฒะพะต)
   - ะะฐัะฟะพะทะฝะฐะฒะฐะฝะธะต ัะตัะธ (ะตัะปะธ ะณะพะปะพัะพะฒะพะต) โ ัะตะบัั

2. **ะัะธััะบะฐ pending prompt**
   - ะัะปะธ ะตััั `user.last_pending_prompt_message_id`:
     - `user_service.clear_pending_prompt(telegram_id)`
     - `last_pending_prompt_message_id = None`
   - ะญัะพ ะฟัะตะดะพัะฒัะฐัะฐะตั ัะดะฐะปะตะฝะธะต ัะถะต ะพัะฒะตัะตะฝะฝัั ะฒะพะฟัะพัะพะฒ

3. **ะกะพััะฐะฝะตะฝะธะต ะผะพะผะตะฝัะฐ**
   - ะกะพะทะดะฐะฝะธะต `Moment` ะฒ ะะ ัะตัะตะท `MomentService`
   - ะกะฒัะทัะฒะฐะฝะธะต ั ะฟะพะปัะทะพะฒะฐัะตะปะตะผ
   - ะกะพััะฐะฝะตะฝะธะต ัะตะบััะฐ ะธ ะผะตัะฐะดะฐะฝะฝัั

4. **ะะตะบัะพัะฝะพะต ะธะฝะดะตะบัะธัะพะฒะฐะฝะธะต**
   - ะกะพะทะดะฐะฝะธะต embedding ัะตัะตะท `KnowledgeIndexer`
   - ะกะพััะฐะฝะตะฝะธะต ะฒ ะฒะตะบัะพัะฝัั ะะ ะดะปั ะฟะพะธัะบะฐ ะฟะพัะพะถะธั ะผะพะผะตะฝัะพะฒ

5. **ะะพะณะธัะพะฒะฐะฝะธะต ัะฐะทะณะพะฒะพัะฐ**
   - ะกะพััะฐะฝะตะฝะธะต ะฒ `ConversationLogService`

6. **ะะพะปะพะถะธัะตะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั**
   - ะัะฟัะฐะฒะบะฐ ะฟะพะดะดะตัะถะธะฒะฐััะตะณะพ ัะพะพะฑัะตะฝะธั (ะตัะปะธ ะฝะฐัััะพะตะฝะพ)

### ะงัะพ ะฒะธะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั:
```
[ะะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะปัะตั]: "ะกะตะณะพะดะฝั ะฑัะป ัะพัะพัะธะน ะดะตะฝั, ะฟัะพะณัะปัะปัั ะฒ ะฟะฐัะบะต"

[ะะพั ะพัะฒะตัะฐะตั]: [ะะพะปะพะถะธัะตะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั, ะฟะตััะพะฝะฐะปะธะทะธัะพะฒะฐะฝะฝะฐั]
```

---

## ๐ฏ ะญัะฐะฟ 5: ะะฐัััะพะนะบะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ)

### ะขัะธะณะณะตั
ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั "โ๏ธ ะะฐัััะพะนะบะธ" ะฒ ะผะตะฝั.

### ะะพัััะฟะฝัะต ะฝะฐัััะพะนะบะธ:
1. **๐ ะะบัะธะฒะฝัะต ัะฐัั** - ะะพะณะดะฐ ะฑะพั ะผะพะถะตั ะฟะธัะฐัั (ะฟะพ ัะผะพะปัะฐะฝะธั: 09:00 - 21:00)
2. **โฐ ะะฝัะตัะฒะฐะป** - ะะฐะบ ัะฐััะพ ะทะฐะดะฐะฒะฐัั ะฒะพะฟัะพัั (ะฟะพ ัะผะพะปัะฐะฝะธั: ะบะฐะถะดัะต 3 ัะฐัะฐ)
3. **๐ ะงะฐัะพะฒะพะน ะฟะพัั** - ะะปั ะฟัะฐะฒะธะปัะฝะพะณะพ ะฒัะตะผะตะฝะธ ะพัะฟัะฐะฒะบะธ (ะฟะพ ัะผะพะปัะฐะฝะธั: UTC)
4. **๐ ะฏะทัะบ ะธะฝัะตััะตะนัะฐ** - ะัะฑะพั ะธะท 11 ัะทัะบะพะฒ
5. **๐ค ะกะพัะธะฐะปัะฝัะน ะฟัะพัะธะปั** - ะกััะปะบะธ ะฝะฐ ัะพััะตัะธ, ะฑะธะพ
6. **๐ฃ ะคะพัะผะฐ ะพะฑัะฐัะตะฝะธั** - ะะพะถะฝะพ ะธะทะผะตะฝะธัั ะฟะพะทะถะต
7. **๐ป ะะพะป** - ะะปั ะฟะตััะพะฝะฐะปะธะทะฐัะธะธ ะฒะพะฟัะพัะพะฒ
8. **๐ ะฃะฒะตะดะพะผะปะตะฝะธั** - ะะบะปััะธัั/ะฒัะบะปััะธัั

**ะะตะบะพะผะตะฝะดะฐัะธั ะฒ ัะตะบััะต ะฟะพะดัะฒะตัะถะดะตะฝะธั:** ะะฐัััะพะธัั ัะฐัะพะฒะพะน ะฟะพัั ะธ ัะฐััะพัั ัะพะพะฑัะตะฝะธะน.

---

## ๐ ะัะตะผะตะฝะฝะฐั ัะบะฐะปะฐ

| ะัะตะผั | ะะตะนััะฒะธะต | ะัะพ ะธะฝะธัะธะธััะตั |
|-------|----------|----------------|
| **T+0s** | `/start` ะบะพะผะฐะฝะดะฐ | ะะพะปัะทะพะฒะฐัะตะปั |
| **T+0.5s** | ะัะธะฒะตัััะฒะตะฝะฝะพะต ะธะทะพะฑัะฐะถะตะฝะธะต | ะะพั |
| **T+1s** | ะัะธะฒะตัััะฒะตะฝะฝะพะต ัะพะพะฑัะตะฝะธะต + ะบะฝะพะฟะบะธ | ะะพั |
| **T+2-10s** | ะัะฑะพั ัะพัะผั ะพะฑัะฐัะตะฝะธั | ะะพะปัะทะพะฒะฐัะตะปั |
| **T+10.5s** | ะกะพะพะฑัะตะฝะธะต ั ะธะฝััััะบัะธัะผะธ | ะะพั |
| **T+11s** | ะะตัะฒัะน ะฒะพะฟัะพั | ะะพั |
| **T+15s-โ** | ะะตัะฒัะน ะพัะฒะตั | ะะพะปัะทะพะฒะฐัะตะปั |

**ะะฑัะฐั ะดะปะธัะตะปัะฝะพััั ะพะฝะฑะพัะดะธะฝะณะฐ:** ~30-60 ัะตะบัะฝะด

---

## ๐ ะะพะปัะทะพะฒะฐัะตะปััะบะธะต ัะพััะพัะฝะธั (User States)

### ะะพ ะพะฝะฑะพัะดะธะฝะณะฐ:
```
user.onboarding_completed = False
user.notifications_enabled = True (ะฟะพ ัะผะพะปัะฐะฝะธั)
user.formal_address = False (ะฟะพ ัะผะพะปัะฐะฝะธั)
user.language_code = "ru" (ะธะปะธ ะธะท Telegram)
```

### ะะพัะปะต ะพะฝะฑะพัะดะธะฝะณะฐ:
```
user.onboarding_completed = True โ
user.formal_address = True/False (ะฒัะฑัะฐะฝะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะผ)
user.notifications_enabled = True
user.last_pending_prompt_message_id = <message_id> (ะฟะพัะปะต ะฟะตัะฒะพะณะพ ะฒะพะฟัะพัะฐ)
```

---

## ๐จ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

### ะกัะตะฝะฐัะธะน 1: Scheduler ะฝะตะดะพัััะฟะตะฝ
- **Fallback:** ะกะพะทะดะฐะตััั ะฒัะตะผะตะฝะฝัะน `NotificationScheduler` ั ะฑะพัะพะผ ะธะท callback
- **ะะพะณะธัะพะฒะฐะฝะธะต:** Warning ะฒ ะปะพะณ

### ะกัะตะฝะฐัะธะน 2: ะะต ัะดะฐะปะพัั ะพัะฟัะฐะฒะธัั ะฒะพะฟัะพั
- **ะะพะณะธัะพะฒะฐะฝะธะต:** Error ะฒ ะปะพะณ
- **ะะตะทัะปััะฐั:** ะะฝะฑะพัะดะธะฝะณ ะทะฐะฒะตััะตะฝ, ะฝะพ ะฒะพะฟัะพั ะฝะต ะพัะฟัะฐะฒะปะตะฝ
- **ะกะปะตะดัััะธะน ัะฐะณ:** ะะพะฟัะพั ะฑัะดะตั ะพัะฟัะฐะฒะปะตะฝ ะฟัะธ ัะปะตะดัััะตะน ะฟัะพะฒะตัะบะต scheduler (ะบะฐะถะดัั ะผะธะฝััั)

### ะกัะตะฝะฐัะธะน 3: ะฃะฒะตะดะพะผะปะตะฝะธั ะพัะบะปััะตะฝั
- **ะะตะทัะปััะฐั:** ะะพะฟัะพั ะฝะต ะพัะฟัะฐะฒะปัะตััั
- **ะะพะณะธัะพะฒะฐะฝะธะต:** Info message

---

## ๐ ะะปััะตะฒัะต ััะฝะบัะธะธ ะธ ะผะพะดัะปะธ

### Handlers:
- `src/bot/handlers/commands.py::cmd_start()` - ะะฑัะฐะฑะพัะบะฐ `/start`
- `src/bot/handlers/callbacks.py::callback_address_informal()` - ะะตัะพัะผะฐะปัะฝะพะต ะพะฑัะฐัะตะฝะธะต
- `src/bot/handlers/callbacks.py::callback_address_formal()` - ะคะพัะผะฐะปัะฝะพะต ะพะฑัะฐัะตะฝะธะต

### Services:
- `src/services/user_service.py::get_or_create_user()` - ะกะพะทะดะฐะฝะธะต/ะฟะพะปััะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั
- `src/services/user_service.py::complete_onboarding()` - ะะฐะฒะตััะตะฝะธะต ะพะฝะฑะพัะดะธะฝะณะฐ
- `src/services/scheduler.py::send_first_question_after_onboarding()` - ะัะฟัะฐะฒะบะฐ ะฟะตัะฒะพะณะพ ะฒะพะฟัะพัะฐ

### Keyboards:
- `src/bot/keyboards/inline.py::get_onboarding_keyboard()` - ะะฝะพะฟะบะธ ะฒัะฑะพัะฐ ัะพัะผั ะพะฑัะฐัะตะฝะธั
- `src/bot/keyboards/inline.py::get_main_menu_inline()` - ะะปะฐะฒะฝะพะต ะผะตะฝั (inline)
- `src/bot/keyboards/reply.py::get_main_menu_keyboard()` - ะะปะฐะฒะฝะพะต ะผะตะฝั (reply)
- `src/bot/keyboards/inline.py::get_question_keyboard()` - ะะฝะพะฟะบะฐ "ะัะพะฟัััะธัั"

### Localization:
- `src/utils/localization.py::get_localized_welcome_text()` - ะัะธะฒะตัััะฒะธะต ะฝะพะฒะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
- `src/utils/localization.py::get_onboarding_text()` - ะขะตะบััั ะพะฝะฑะพัะดะธะฝะณะฐ
- `src/utils/localization.py::ONBOARDING_TEXTS` - ะกะปะพะฒะฐัั ัะตะบััะพะฒ ะพะฝะฑะพัะดะธะฝะณะฐ

---

## โ ะงะตะบ-ะปะธัั ะดะปั ะฟัะพะฒะตัะบะธ ะพะฝะฑะพัะดะธะฝะณะฐ

- [ ] ะัะธะฒะตัััะฒะตะฝะฝะพะต ะธะทะพะฑัะฐะถะตะฝะธะต ะพัะฟัะฐะฒะปัะตััั
- [ ] ะัะธะฒะตัััะฒะตะฝะฝะพะต ัะพะพะฑัะตะฝะธะต ะปะพะบะฐะปะธะทะพะฒะฐะฝะพ ะฟัะฐะฒะธะปัะฝะพ
- [ ] ะะฝะพะฟะบะธ ัะพัะผั ะพะฑัะฐัะตะฝะธั ะพัะพะฑัะฐะถะฐัััั
- [ ] ะัะฑะพั "ัั" ัะพััะฐะฝัะตััั ะธ ะฟะพะบะฐะทัะฒะฐะตั ะฟัะฐะฒะธะปัะฝัะน ัะตะบัั
- [ ] ะัะฑะพั "ะฒั" ัะพััะฐะฝัะตััั ะธ ะฟะพะบะฐะทัะฒะฐะตั ะฟัะฐะฒะธะปัะฝัะน ัะตะบัั
- [ ] ะะปะฐะฒะฝะพะต ะผะตะฝั ะฟะพัะฒะปัะตััั ะฟะพัะปะต ะฒัะฑะพัะฐ
- [ ] Reply ะบะปะฐะฒะธะฐัััะฐ ะฟะพัะฒะปัะตััั ะฒะฝะธะทั
- [ ] ะะฝะฑะพัะดะธะฝะณ ะฟะพะผะตัะฐะตััั ะบะฐะบ ะทะฐะฒะตััะตะฝะฝัะน ะฒ ะะ
- [ ] ะะตัะฒัะน ะฒะพะฟัะพั ะพัะฟัะฐะฒะปัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ
- [ ] ะะพะฟัะพั ะฐะดะฐะฟัะธัะพะฒะฐะฝ ะฟะพะด ัะพัะผั ะพะฑัะฐัะตะฝะธั
- [ ] ะะพะฟัะพั ะฐะดะฐะฟัะธัะพะฒะฐะฝ ะฟะพะด ะฟะพะป ะฟะพะปัะทะพะฒะฐัะตะปั
- [ ] ะะฝะพะฟะบะฐ "ะัะพะฟัััะธัั" ะฟัะธัััััะฒัะตั
- [ ] `last_pending_prompt_message_id` ัะพััะฐะฝัะตััั

---

## ๐จ UX ัะปัััะตะฝะธั (ัะตะบะพะผะตะฝะดะฐัะธะธ)

1. **ะะพะฑะฐะฒะธัั ะฐะฝะธะผะฐัะธั ะทะฐะณััะทะบะธ** ะฟัะธ ะพัะฟัะฐะฒะบะต ะฟะตัะฒะพะณะพ ะฒะพะฟัะพัะฐ
2. **ะะพะฑะฐะฒะธัั ะฟะพะดัะฒะตัะถะดะตะฝะธะต** ะฟะตัะตะด ะทะฐะฒะตััะตะฝะธะตะผ ะพะฝะฑะพัะดะธะฝะณะฐ ("ะะพัะพะฒั ะฝะฐัะฐัั?")
3. **ะะพะฑะฐะฒะธัั ะฟัะธะผะตัั ะพัะฒะตัะพะฒ** ะฒ ะธะฝััััะบัะธั
4. **ะะพะฑะฐะฒะธัั ะฒะธะดะตะพ-ะดะตะผะพะฝัััะฐัะธั** ะบะฐะบ ัะฐะฑะพัะฐะตั ะฑะพั
5. **ะะพะฑะฐะฒะธัั ะฑัััััั ะฝะฐัััะพะนะบั ัะฐัะพะฒะพะณะพ ะฟะพััะฐ** ะฟััะผะพ ะฒ ะพะฝะฑะพัะดะธะฝะณะต (ะฒะผะตััะพ ะฟะพะทะถะต)

---

**ะะพะบัะผะตะฝั ัะพะทะดะฐะฝ:** 2026-01-21  
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต:** 2026-01-21
